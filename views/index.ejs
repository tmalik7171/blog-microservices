<%- layout('./layouts/boilerplate.ejs'); %>

<main class="container my-5">
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h1 class="h3 mb-0">All Blogs</h1>
		<a href="/blogs/new" class="btn btn-primary">New Blog</a>
	</div>

	<% if (!allBlogs || allBlogs.length === 0) { %>
			<div class="alert alert-info">
				No blogs yet. <a href="/blogs/new" class="alert-link">Create first blog</a>.
			</div>
	<% } else { %>
		<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
			<% allBlogs.forEach(function(blog){ %>
				<div class="col">
					<div class="card h-100 shadow-sm">
						<div class="card-body d-flex flex-column">
							<h5 class="card-title"><%= blog.title %></h5>
							<p class="card-text text-muted small mb-2">
								<% if (blog.createdAt) { %>
									<%= new Date(blog.createdAt).toLocaleDateString() %>
								<% } %>
								<% if (blog.owner) { %>
									<span class="ms-2">by <%= blog.owner.username %></span>
								<% } %>
							</p>

							<p class="card-text mb-4">
								<% var excerpt = (blog.content || '').substring(0, 200); %>
								<%= excerpt %><%= (blog.content && blog.content.length > 200) ? '...' : '' %>
							</p>

							<div class="mt-auto d-flex justify-content-between align-items-center">
								<a href="/blogs/<%= blog._id %>" class="btn btn-sm btn-outline-primary">Read</a>
							</div>
						</div>
					</div>
				</div>
			<% }) %>
		</div>
	<% } %>
</main>